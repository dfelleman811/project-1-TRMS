<!DOCTYPE html>
<html lang="en">
<head>
     <!-- This is the page that will display details of the selected request - and allow the supervisor to approve or request more information-->
    <title>Resource Details</title>
</head>
<body onload='loadSession()'>

<h1>Development Resource Page</h1>
   

    

<!-- When a request has been given a grade by the employee, there should automatically generate a notice
to the benco that, if the grade is passing, they should be reimbursed-->

<label for='approval'>FOR DEPT HEAD:</label>
<select id='approval' value='selectOne' required>
    <option value='selectOne'>-- Select One --</option>
    <option value='approved'>Approved</option>
    <option value='moreInfo'>Request More Information</option>
</select>
<input id='approve' type='submit' onclick='updateRequest()'>

</body>
<script>

    function loadSession() {

        // get session devres info
        let xhttp = new XMLHttpRequest();

        xhttp.open('GET', "http://localhost:8080/Project-1-TRMS/resSession.do", true);

        xhttp.send();

        xhttp.onreadystatechange = function() {

            if (this.readyState == 4 && this.status == 200) {
                console.log(this.responseText);
            }
        }

        


    }


    function updateRequest() {

        // collect input
        let newStatus = document.getElementById('approval').value;

        // get session current req info
        let xhttp2 = new XMLHttpRequest();

        xhttp2.open("GET", "http://localhost:8080/Project-1-TRMS/reqSession.do", true);

        xhttp2.send();

        xhttp2.onreadystatechange = function() {
            if (this.readyState == 4 && this.status == 200) {
                console.log(this.responseText);

                let curReq = JSON.parse(this.responseText);

                let reqUpdate = {
                    requestId: curReq.requestId,
                    isUrgent: curReq.isUrgent,
                    status: newStatus
                }

                // send post request with new status
                let xhttp = new XMLHttpRequest();

                xhttp.open("POST", "http://localhost:8080/Project-1-TRMS/updateStatus.do", true);

                xhttp.send(JSON.stringify(reqUpdate));

                xhttp.onreadystatechange = function() {
                    if (this.readyState == 4 && this.status == 200) {
                        console.log(this.responseText);
                    }
                 }       
            }
            
        }
        

        
    }

</script>
</html>